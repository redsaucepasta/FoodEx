<!-- <% menu.forEach(function(item){%>
<p><%= item.outlet.name %></p>
<p><%= item.item.name %></p>
<% }); %> -->



<!-- <%= outletName %>
<form action="/outlet/<%= outlet._id %>" method="post">
  <input type="text" name="itemname" value="">
  <input type="text" name="itemprice" value="">
  <button type="submit" name="button">Publish</button>
</form> -->


Outlet.find({}, function(err, outlets){
  res.render("outletlist", {outletList: outlets});
});


const requestedOutletId = req.params.outletId;
Menu.findOne({_id: requestedOutletId}, function(err, foundMenu) {
  res.render("menu", {menu: foundMenu});
});





let body = req.body;
for(let itemname in body){
  itemq = body[itemname];
  if(itemq>0){
    res.write(itemname+" : "+itemq+"\n");
  }
}

res.send();




<div class="">
  <form action="/home/<%= outletId %>" method="post">
    <% (menu.item).forEach(function(item){%>
    <p><%= item.name %> : <%= item.price %>
      <select name="<%= item.name %>">
        <option value="0">0</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
      </select></p>
    <% }); %>
    <p><input type="submit" value="Add to Cart"></p>
  </form>

</div>




User.findOne({username: req.user.username}, function(err, foundUser) {
  if (!err) {
    Cart.findOneAndUpdate({_id: foundUser._id}, {$push: {item: details}}, function(err, succ) {
      if(err){
        console.log(err);
      }
      else {
        console.log(succ);
      }
    });
  }
  else {
    console.log(err);
  }
});


items = foundCart.item;
for(let i=0; i<items.length; i++){
  if(items[i]._id == requestedItemId){
    if(items[i].quantity === 1){
      items.splice(i,1);
    }
    else{
      let newq = items[i].quantity - 1;
      items[i].quantity = newq;
    }
  }
}
Cart.findOneAndUpdate({_id: foundUser._id}, {item: items}, function(err, succ) {
  if(err){
    console.log(err);
  }
  else{
    res.redirect("/home/cart");
  }
});
}
else {
console.log(err);
}
});


class="collapse navbar-collapse" id="navbarSupportedContent"



console.log("cart contains items from the same outlet");
existingItems = foundCart.item;
let elen = existingItems.length;
let dlen = detailsArray.length;
console.log(existingItems);
console.log(detailsArray);
console.log("________BEFORE LOOP_______");
for(let a = 0; a<elen; a++){
  for(let b = 0; b<dlen; b++){
    if (existingItems[a].name === detailsArray[b].name){
      existingItems[a].quantity = Number(existingItems[a].quantity) + Number(detailsArray[b].quantity);
      newArrayOfDetails.push(existingItems[a]);
    }
    else {
      newArrayOfDetails.push(detailsArray[b]);
    }
  }
}
console.log(newArrayOfDetails);



Cart.findOne({_id: foundUser._id}, function(err, foundCart) {
  (foundCart.item).forEach(function(item) {
    if(item.name === details.name){
      details.quantity = Number(item.quantity) + Number(details.quantity);
      item.quantity = details.quantity;
      details = {};
      foundCart.save();
    }
    else {
      if(Object.keys(details).length !== 0){
        Cart.findOneAndUpdate({_id: foundUser._id}, {$push: {item: details}, outlet: outlet}, function(err, succ) {
          if(err){
            console.log(err);
          }
        });
      }
    }
  });
});



Menu.findOne({_id: requestedOutletId}, function(err, foundMenu) {
  if(!err){
    for(let itemname in body){
      itemq = body[itemname];
      if(itemq>0){
        (foundMenu.item).forEach(function(item) {
          if (item.name===itemname){
            details = {"name": item.name, "price": item.price, "quantity": itemq};
            detailsArray.push(details);
          }
        });
      }
    }
  }
  console.log("dets");
  console.log(detailsArray);
});


function compare(a, b) {
  // Use toUpperCase() to ignore character casing
  const bandA = a.name.toUpperCase();
  const bandB = b.name.toUpperCase();

  let comparison = 0;
  if (bandA > bandB) {
    comparison = 1;
  } else if (bandA < bandB) {
    comparison = -1;
  }
  return comparison;
}
console.log("sorted dets");
console.log(detailsArray.sort(compare));
console.log("sorted existing");
console.log(existingItems.sort(compare));

<% outletList.forEach(function(outlet){ %>
<a class="outletName centered" href="/menu/<%= outlet._id %>">
  <!-- <div class="jumbotron"> -->
    <%= outlet.name %>
  <!-- </div> -->
</a>
<% }); %>
